mover:
  name: mpidatamover

directories:
  zarr: ${SCRATCH}/nested-eagle/0.25deg-06km/data/hrrr.zarr
  cache: ${SCRATCH}/nested-eagle/0.25deg-06km/data/cache/hrrr
  logs: ${SCRATCH}/nested-eagle/0.25deg-06km/data/logs/hrrr

multisource:

  # Analysis data
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2015-02-01T06
        end: 2024-01-31T18
        freq: 6h

      fhr:
        start: 0
        end: 0
        step: 6

      variables:
        # 3D Prognostic
        - gh
        - u
        - v
        - w
        - t
        - q
        # 2D Prognostic
        - sp
        - u10
        - v10
        - t2m
        - t_surface
        - sh2
        # Diagnostic
        - u80
        - v80
        # Forcing
        - lsm
        - orog

      levels:
        - 100
        - 150
        - 200
        - 250
        - 300
        - 400
        - 500
        - 600
        - 700
        - 850
        - 925
        - 1000

    transforms:
      rotate_vectors:
        vector_pairs:
          - ["u", "v"]
          - ["u10", "v10"]
          - ["u80", "v80"]

  # Forecast data
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2015-02-01T00
        end: 2024-01-31T12
        freq: 6h

      fhr:
        start: 6
        end: 6
        step: 6

      variables:
        # Diagnostic
        - accum_tp

transforms:
  horizontal_regrid:
    target_grid_path: ${SCRATCH}/nested-eagle/0.25deg-06km/data/hrrr_06km.nc
    regridder_kwargs:
      method: conservative
      reuse_weights: True
      filename: ${SCRATCH}/nested-eagle/0.25deg-06km/data/conservative_weights_hrrr.nc

target:
  name: anemoi
  sort_channels_by_levels: True
  compute_temporal_residual_statistics: False
  statistics_period:
    start: 2015-02-01T06
    end: 2023-01-31T18
  forcings:
    - cos_latitude
    - sin_latitude
    - cos_longitude
    - sin_longitude
    - cos_julian_day
    - sin_julian_day
    - cos_local_time
    - sin_local_time
    - insolation

  chunks:
    time: 1
    variable: -1
    ensemble: 1
    cell: -1
