mover:
  name: mpidatamover

directories:
  zarr: ${SCRATCH}/nested-eagle/0.25deg-06km/baselines/hrrr-forecasts-vs-aorc/hrrr.forecasts.12h.zarr
  cache: ${SCRATCH}/nested-eagle/0.25deg-06km/baselines/hrrr-forecasts-vs-aorc/cache/12h
  logs: ${SCRATCH}/nested-eagle/0.25deg-06km/baselines/hrrr-forecasts-vs-aorc/logs/12h

multisource:
  # 7h
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2023-02-01T00
        end: 2024-01-31T12
        freq: 6h
      fhr:
        start: 7
        end: 8
        step: 6
      variables:
        - accum_tp
      accum_hrs:
        accum_tp: 1
  # 8h
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2023-02-01T00
        end: 2024-01-31T12
        freq: 6h
      fhr:
        start: 8
        end: 9
        step: 6
      variables:
        - accum_tp
      accum_hrs:
        accum_tp: 1
  # 9h
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2023-02-01T00
        end: 2024-01-31T12
        freq: 6h
      fhr:
        start: 9
        end: 10
        step: 6
      variables:
        - accum_tp
      accum_hrs:
        accum_tp: 1
  # 10h
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2023-02-01T00
        end: 2024-01-31T12
        freq: 6h
      fhr:
        start: 10
        end: 11
        step: 6
      variables:
        - accum_tp
      accum_hrs:
        accum_tp: 1
  # 11h
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2023-02-01T00
        end: 2024-01-31T12
        freq: 6h
      fhr:
        start: 11
        end: 12
        step: 6
      variables:
        - accum_tp
      accum_hrs:
        accum_tp: 1
  # 12h
  - source:
      name: aws_hrrr_archive
      t0:
        start: 2023-02-01T00
        end: 2024-01-31T12
        freq: 6h
      fhr:
        start: 12
        end: 13
        step: 6
      variables:
        - accum_tp
      accum_hrs:
        accum_tp: 1

transforms:
  horizontal_regrid:
    target_grid_path: ${SCRATCH}/nested-eagle/0.25deg-06km/data/hrrr_06km.nc
    regridder_kwargs:
      method: conservative
      reuse_weights: True
      filename: ${SCRATCH}/nested-eagle/0.25deg-06km/data/conservative_weights.nc

merged_transforms:
  xarray_coarsen:
    reduction: sum
    dim:
      fhr: 6
    coord_func: max

target:
  name: base
  chunks:
    t0: 1
    fhr: 1
    y: -1
    x: -1
